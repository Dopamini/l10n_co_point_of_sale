<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>
    <template id="report_sessionsummary_inherit" inherit_id="point_of_sale.report_sessionsummary" name="Informe Diario Sesion">
        <xpath expr="//div[@class='page']" position="replace">
            <t t-if="o.order_ids">
                <div class="page" style="font-zize:18px !important;">
                    <h2 style="text-align:center"><span t-field="o.user_id.company_id.name"/></h2>
                    <h4 style="text-align:center;width: 100%;"><span t-field="o.user_id.company_id.partner_id.formatedNit"/></h4>
                    <h2>Daily POS Sales Report</h2>
                    <div class="row mt32 mb32" style="line-height: 24px;">
                        <div class="col-xs-5">
                            <strong>Session No</strong>:
                            <span t-field="o.name"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>Voucher Date</strong>:
                            <span t-field="o.stop_at"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>Responsable</strong>:
                            <span t-field="o.user_id"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>Point of sale</strong>:
                            <span t-field="o.config_id.name"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>Hardware ID</strong>:
                            <span t-field="o.mac"/>
                        </div>
                    </div>
                    <div class="row mt32 mb32" style="line-height: 24px;">
                        <div class="col-xs-5">
                            <strong>Initial date</strong>:<br/>
                            <span t-field="o.start_at"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>Closing Date</strong>:<br/>
                            <span t-field="o.stop_at"/>
                        </div>
                    </div>
                    <div class="row mt32 mb32" style="line-height: 24px;">
                        <div class="col-xs-5">
                            <strong>No. Initial Registration</strong>:<br/>
                            <span t-field="o.order_ids[-1].name"/>
                        </div>
                        <div class="col-xs-5">
                            <strong>No. Final Registration</strong>:<br/>
                            <span t-field="o.order_ids[0].name"/>
                        </div>
                    </div>
                    <div style="width:50%; float:left;">
                    <div class="row mt32 mb32" style="line-height: 24px;">
                        <h3 style="font-weight: bold;">Total Sales POS</h3>
                        <div t-raw="o.taxes_description"/>
                    </div>
                    <div class="row mt32 mb32" style="line-height: 24px;">
                        <h3 style="font-weight: bold;">Total:</h3>
                            <t t-set="total" t-value="0"/>
                            <t t-set="subtotal" t-value="0"/>
                            <t t-set="sumsubtotal" t-value="0"/>
                            <t t-set="subtotaldiscount" t-value="0"/>
                            <t t-set="descuentos" t-value="0"/>
                            <t t-set="iva" t-value="0"/>
                            <t t-set="cnt" t-value="0"/>
                            <t t-set="impuesto" t-value="Iva"/>
                            
                            <t t-foreach="o.order_ids" t-as="order">
                                <t t-set="cnt" t-value="cnt + 1"/>
                                <t t-foreach="order.lines" t-as="lineas">
                                    <t t-set="impuesto" t-value="lineas.tax_ids_after_fiscal_position.name"/>
                                    <t t-if="impuesto == lineas.tax_ids_after_fiscal_position.name">

                                        <t t-set="descuentos" t-value="descuentos + round((lineas.price_unit * lineas.qty)*(lineas.discount)/100)"/>
                                        <t t-set="subtotal" t-value="subtotal + lineas.price_subtotal"/>            
                                    </t>

                                </t>
                                <t t-set="total" t-value="total + order.amount_total" t-field-options='{"widget": "monetary", "display_currency": "pos_order.currency_id"}'/>
                                <t t-set="iva" t-value="iva + order.amount_tax" t-field-options='{"widget": "monetary", "display_currency": "pos_order.currency_id"}'/>
                            </t>
                            
                            <strong>Number of Sales Done:</strong>
                            <span t-esc="cnt"/><br/>
                            <strong>Sales:</strong>
                            <span t-esc="subtotal + descuentos" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                            <strong>Total Discount:</strong>
                            <span t-esc="descuentos" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                            <strong>Subtotal:</strong>
                            <span t-esc="subtotal" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                            <strong>Valor Iva: </strong>
                            <span t-esc="iva" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                            <strong>Total: </strong>
                            <span t-esc="total" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                    </div> 
                    </div>
                    <div class="row mt32 mb32" style="line-height: 24px; width:50%; float:left;">
                        <h3 style="font-weight: bold;">Total Payment Method</h3>
                        <t t-set="total_pyment" t-value="0"/>
                        <t t-set="total_transactions" t-value="0"/>               
                        <t t-foreach="o.statement_ids" t-as="statement">
                            <strong>Reference</strong> : <span t-field="statement.name"/><br/>
                            <strong>Journal</strong> : <span t-field="statement.journal_id"/><br/>
                            <!--<t t-if="statement.journal_id.type == 'cash'">
                                <t t-set="total_transactions" t-value="statement.total_entry_encoding"/>
                            </t>-->
                            <!--<t t-if="statement.journal_id.type != 'cash'">-->
                            <t t-set="total_transactions" t-value="statement.total_entry_encoding"/>
                            <!--</t>-->
                            <strong>Total Transactions</strong> : <span t-esc="total_transactions" t-esc-options='{"widget": "monetary", "display_currency": "statement.currency_id"}'/><br/>
                        
                            <t t-set="total_pyment" t-value="total_pyment + statement.total_entry_encoding"/>      
                        </t>
                        <!--<strong>Total Change : </strong>
                        <t t-if="o.amount_change == 0">
                            <span t-esc="o.amount_change" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br />
                        </t>
                        <t t-if="o.amount_change &#60; 0">
                            <span t-esc="o.amount_change * -1" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br />
                        </t>
                       -->
                        <strong>Total Pyments Method : </strong>
                        <span t-esc="total_pyment" t-esc-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/><br/>
                    </div>            
                </div>

            </t>
            <t t-if="not o.order_ids">
                <h2><span>No se encontró ventas para esta sesión</span></h2>
            </t>
        </xpath>
    </template>
<template id="report_sessionsummary">
    <t t-call="report.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="report.internal_layout">
                
            </t>
        </t>
    </t>
</template>
</data>
</openerp>
